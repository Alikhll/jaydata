<!DOCTYPE html>
<html>
<head>
    <title>JayData unit tests</title>
    <meta charset=utf-8 />
    <script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
    <script src="Scripts/modernizr-2.5.3.js"></script>
    <script src="Scripts/datajs-1.1.0.js"></script>

    <!--************************************************************************************-->
    <script type="text/javascript" src="TypeSystem/initializeJayDataClient.js"></script>
    <script type="text/javascript" src="TypeSystem/initializeJayData.js"></script>    
    <script type="text/javascript" src="TypeSystem/utils.js"></script>
    <script type="text/javascript" src="TypeSystem/PreHtml5Compatible.js"></script>
    <script type="text/javascript" src="TypeSystem/JayLint.js"></script>
    <script type="text/javascript" src="TypeSystem/TypeSystem.js"></script>
    <script type="text/javascript" src="TypeSystem/Trace/Trace.js"></script>
    <script type="text/javascript" src="TypeSystem/Trace/Logger.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/SimpleBase.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Geospatial.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Geography.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Geometry.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/Guid.js"></script>
    <script type="text/javascript" src="TypeSystem/Types/EdmTypes.js"></script>
    <script type="text/javascript" src="TypeSystem/Extensions.js"></script>
    <!--*******************************Expressions****************************************-->
    <script type="text/javascript" src="Types/Expressions/ASTParser.js"></script>
    <script type="text/javascript" src="Types/Expressions/ExpressionNode2.js"></script>
    
    <script type="text/javascript" src="Types/Expressions/ArrayLiteralExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/CallExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/CodeParser.js"></script>
    <script type="text/javascript" src="Types/Expressions/ConstantExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/FunctionExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ObjectFieldExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ObjectLiteralExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/PagingExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ParameterExpression.js"> </script>
    <script type="text/javascript" src="Types/Expressions/PropertyExpression.js" ></script>   
    <script type="text/javascript" src="Types/Expressions/SimpleBinaryExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ThisExpression.js" ></script>    
    
    <script type="text/javascript" src="Types/Expressions/Visitors/ExpressionVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ParameterProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/GlobalContextProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LocalContextProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LambdaParameterProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ParameterResolverVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LogicalSchemaBinderVisitor.js"></script>

    <script type="text/javascript" src="Types/Expressions/Visitors/ExpTreeVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/SetExecutableVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ExecutorVisitor.js"></script>
    
    <script type="text/javascript" src="Types/Expressions/ExpressionBuilder.js"></script>
    <script src="Types/Transaction.js"></script>
    <script src="Types/StorageProviders/SqLite/SqlTransaction.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDBTransaction.js"></script>

    <script type="text/javascript" src="Types/Expressions/EntityExpressions/AssociationInfoExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/CodeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/CodeToEntityConverter.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ComplexTypeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityContextExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityExpressionVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityFieldExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityFieldOperationExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntitySetExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ServiceOperationExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/FrameOperationExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/FilterExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/IncludeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/MemberInfoExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/OrderExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ParametricQueryExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ProjectionExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/QueryExpressionCreator.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/QueryParameterExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/RepresentationExpression.js"></script>

    <script type="text/javascript" src="Types/Expressions/ContinuationExpressionBuilder.js"></script>
    
    <!--******************************* Validation ****************************************-->  
    <script type="text/javascript" src="Types/Validation/EntityValidationBase.js"></script>
    <script type="text/javascript" src="Types/Validation/EntityValidation.js"></script>
    <!--******************************* Notification ****************************************-->  
    <script type="text/javascript" src="Types/Notifications/ChangeDistributorBase.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeCollectorBase.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeDistributor.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeCollector.js"></script>
    
    <!--******************************* Types ****************************************--> 
    <script type="text/javascript" src="Types/Access.js"></script>
    <script type="text/javascript" src="Types/Promise.js"></script>
    <script type="text/javascript" src="Types/Entity.js"></script>
    <script type="text/javascript" src="Types/EntityContext.js"></script>
    <script type="text/javascript" src="Types/QueryProvider.js"></script>
    <script type="text/javascript" src="Types/ModelBinder.js"></script>
    <script type="text/javascript" src="Types/QueryBuilder.js"></script>
    <script type="text/javascript" src="Types/Query.js"></script>
    <script type="text/javascript" src="Types/Queryable.js"></script>
    <script type="text/javascript" src="Types/EntitySet.js"></script>

    <script type="text/javascript" src="Types/AuthEntityContext.js"></script>
    <script type="text/javascript" src="Types/EntityState.js"></script>
    <script type="text/javascript" src="Types/EntityStateManager.js"></script>
    <script type="text/javascript" src="Types/ItemStore.js"></script>
    <script type="text/javascript" src="Types/Exception.js"></script>
    <script type="text/javascript" src="Types/StorageProviderLoader.js"></script>
    <script type="text/javascript" src="Types/StorageProviderBase.js"></script>
    <script type="text/javascript" src="Types/ServiceOperation.js"></script>

    <script type="text/javascript" src="Types/EntityWrapper.js"></script>
    <script type="text/javascript" src="JaySvcUtil/JaySvcUtil.js"></script>
    <script type="text/javascript" src="Types/JayStorm.js"></script>

    <!--******************************* Ajax*********************************************-->    
    <script type="text/javascript" src="Types/Ajax/jQueryAjaxWrapper.js"></script>
    <script type="text/javascript" src="Types/Ajax/WinJSAjaxWrapper.js"></script>
    <script type="text/javascript" src="Types/Ajax/ExtJSAjaxWrapper.js"></script>        
    <script type="text/javascript" src="Types/Ajax/AjaxStub.js"></script>

    <!--******************************* DbClient ****************************************-->
    <script type="text/javascript" src="Types/DbClient/DbCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/DbConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/OpenDatabaseClient/OpenDbCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/OpenDatabaseClient/OpenDbConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/JayStorageClient/JayStorageCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/JayStorageClient/JayStorageConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/SqLiteNjClient/SqLiteNjCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/SqLiteNjClient/SqLiteNjConnection.js"></script>

    <script type="text/javascript" src="Types/StorageProviders/modelBinderConfigCompiler.js"></script>
    <!--******************************* StorageProvider - sqLite ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqLiteStorageProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqLiteCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlPagingCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlOrderCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlProjectionCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/ExpressionMonitor.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlFilterCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/ModelBinder/sqLite_ModelBinderCompiler.js"></script>
    <!--******************************* StorageProvider - oData ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataWhereCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataOrderCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataPagingCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataProjectionCompiler.js"></script>
    <!--******************************* StorageProvider - IndexDb ****************************************-->
    <script src="Types/StorageProviders/IndexedDB/IndexedDBCompiler.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDbExpressionExecutor.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDBLogicalAndFilterExpression.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDBLogicalInFilterExpression.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDBLogicalOrFilterExpression.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDBPhysicalAndFilterExpression.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDBStorageProvider.js"></script>
    <script src="Types/StorageProviders/IndexedDB/IndexedDBTransaction.js"></script>
    
    <!--******************************* Authentication???? ****************************************-->
    <script type="text/javascript" src="Types/Authentication/AuthenticationBase.js"></script>
    <script type="text/javascript" src="Types/Authentication/Anonymous.js"></script>
    <script type="text/javascript" src="Types/Authentication/FacebookAuth.js"></script>

    <!--******************************* StorageProvider - Facebook ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/Facebook/FacebookProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/FacebookCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/user.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/friend.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/page.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQLContext.js"></script>
    
    <!--******************************* StorageProvider - YQL ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/YQL/YQLProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/YQLCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/EntitySets/geo.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/EntitySets/YQLContext.js"></script>
        
    <!--******************************* StorageProvider - inMemory ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/InMemory/InMemoryProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/InMemory/InMemoryCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/InMemory/InMemoryFunctionCompiler.js"></script>

    <!--******************************* StorageProvider - webApi ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/WebApi/WebApiProvider.js"></script>

    <!--******************************* OData Parser ****************************************-->
    <script type="text/javascript" src="oDataParser/RequestExpressionBuilder.js"></script>
    <script type="text/javascript" src="oDataParser/RequestLexer.js"></script>
    <script type="text/javascript" src="oDataParser/RequestParser.js"></script>

    <script type="text/javascript" src="oDataParser/EntityExpressionBuilder.js"></script>
    <script type="text/javascript" src="oDataParser/ODataEntityExpressionBuilder.js"></script>


    <!--******************************* jsExtensions ****************************************-->
    <script type="text/javascript" src="JayDataModules/deferred.js"></script>
    <script type="text/javascript" src="JayDataModules/formBinder.js"></script>
    <script type="text/javascript" src="JayDataModules/template.js"></script>
    <script type="text/javascript" src="JayDataModules/validate.js"></script>
    <script type="text/javascript" src="JayDataModules/knockout.js"></script>
    <script type="text/javascript" src="JayDataModules/inMemory.js"></script>
    <!--************************************************************************************-->
    <script id="xxx" src="Pro/JayDataModules/localMigrations.js"></script>

    <!--**********************************UNIT TESTS****************************************-->
    <script id="abc_definition">
        $data.defineSchema("abcDatabase", function (container) {
            c = container;
            $data.Entity.extend("Product", container, {
                Id: { type: 'int', key: true, computed: true },
                Name: { type: String },
                Category: { type: "Category", inverseProperty: "Products" }
            });

            $data.Entity.extend("Category", container, {
                Id: { type: 'int', key: true, computed: true },
                Name: { type: String },
                Name2: { type: String },
                Name3: { type: String },
                Products: { type: Array, elementType: container.Product, inverseProperty: "Category" }
            });


            return $data.EntityContext.extend("EC", container, {
                Products: { type: $data.EntitySet, elementType: container.Product },
                Categories: { type: $data.EntitySet, elementType: container.Category, indices: [{ name: 'xxxx', keys: ['Name', 'Name2'] }] }
            });
        });
        //v6 some txt
    </script>    


    <script>
        //var container = $data.createContainer();
        //$data.defineSchema("abcDatabase", function (container) {
        //    c = container;
        //    $data.Entity.extend("Product", container, {
        //        Id: { type: 'int', key: true, computed: true },
        //        Name: { type: String },
        //        Category: { type: "Category", inverseProperty: "Products" }
        //    });

        //    $data.Entity.extend("Category", container, {
        //        Id: { type: 'int', key: true, computed: true },
        //        Name: { type: String },
        //        Name2: { type: String },
        //        Name3: { type: String },
        //        Products: { type: Array, elementType: container.Product, inverseProperty: "Category" }
        //    });


        //    return $data.EntityContext.extend("EC", container, {
        //        Products: { type: $data.EntitySet, elementType: container.Product },
        //        Categories: { type: $data.EntitySet, elementType: container.Category, indices: [{ name: 'xxxx', keys: ['Name', 'Name2'] }] }
        //    });
        //});

        //var c = new c.EC({ provider: 'local', databaseName: 'abc' });
        //c = $data.createContainer();
        //$data.Entity.extend("XXX", c, {});
        //c.XXX.extend("YYYY", c)

        $data.registerSchema("abcDatabase", document.getElementById("abc_definition"));

        var x = $data.EntityContext.createFromSchema("abcDatabase", {
            onSchemaChange: function (defer, ctxNew, ctxOld) {
                defer.resolve(true)
            }
        });

        //        ctxOld.Products.toArray()
        //                       .then(function (items) {
        //                            //ctxNew.Products.addMany(items);
        //                            //ctxNew.saveChanges().done(defer.resolve).fail(defer.reject);
        //                       })
        //                       .fail(function () { console.log("err old toarray"); });

        //    }
        //});
    </script>
</head>
<body>

</body>
</html>

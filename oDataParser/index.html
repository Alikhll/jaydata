<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="../scripts/qunit.css" type="text/css" media="screen" />

    <script type="text/javascript" src="../scripts/qunit.js"></script>
    <script type="text/javascript" src="../scripts/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="../Scripts/jquery.validate.js"></script>
    <script type="text/javascript" src="../Scripts/knockout-2.1.0.js"></script>

    <!--************************************************************************************-->
    <script type="text/javascript" src="../TypeSystem/initializeJayDataClient.js"></script>
    <script type="text/javascript" src="../TypeSystem/initializeJayData.js"></script>
    <script type="text/javascript" src="../TypeSystem/utils.js"></script>
    <script type="text/javascript" src="../TypeSystem/PreHtml5Compatible.js"></script>
    <script type="text/javascript" src="../Scripts/datajs-1.0.3.js"></script>
    <script type="text/javascript" src="../TypeSystem/JayLint.js"></script>
    <script type="text/javascript" src="../TypeSystem/TypeSystem.js"></script>
    <!--*******************************Expressions****************************************-->
    <script type="text/javascript" src="../Types/Expressions/ASTParser.js"></script>
    <script type="text/javascript" src="../Types/Expressions/ExpressionNode2.js"></script>

    <script type="text/javascript" src="../Types/Expressions/ArrayLiteralExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/CallExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/CodeParser.js"></script>
    <script type="text/javascript" src="../Types/Expressions/ConstantExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/FunctionExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/ObjectFieldExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/ObjectLiteralExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/PagingExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/ParameterExpression.js"> </script>
    <script type="text/javascript" src="../Types/Expressions/PropertyExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/SimpleBinaryExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/ThisExpression.js"></script>

    <script type="text/javascript" src="../Types/Expressions/Visitors/ExpressionVisitor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/ParameterProcessor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/GlobalContextProcessor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/LocalContextProcessor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/LambdaParameterProcessor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/ParameterResolverVisitor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/LogicalSchemaBinderVisitor.js"></script>

    <script type="text/javascript" src="../Types/Expressions/Visitors/ExpTreeVisitor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/SetExecutableVisitor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/Visitors/ExecutorVisitor.js"></script>

    <script type="text/javascript" src="../Types/Expressions/ExpressionBuilder.js"></script>

    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/AssociationInfoExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/CodeExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/CodeToEntityConverter.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/ComplexTypeExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/EntityContextExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/EntityExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/EntityExpressionVisitor.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/EntityFieldExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/EntityFieldOperationExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/EntitySetExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/ServiceOperationExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/FrameOperationExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/FilterExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/IncludeExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/MemberInfoExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/OrderExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/ParametricQueryExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/ProjectionExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/QueryExpressionCreator.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/QueryParameterExpression.js"></script>
    <script type="text/javascript" src="../Types/Expressions/EntityExpressions/RepresentationExpression.js"></script>

    <!--******************************* Validation ****************************************-->
    <script type="text/javascript" src="../Types/Validation/EntityValidationBase.js"></script>
    <script type="text/javascript" src="../Types/Validation/EntityValidation.js"></script>
    <!--******************************* Notification ****************************************-->
    <script type="text/javascript" src="../Types/Notifications/ChangeDistributorBase.js"></script>
    <script type="text/javascript" src="../Types/Notifications/ChangeCollectorBase.js"></script>
    <script type="text/javascript" src="../Types/Notifications/ChangeDistributor.js"></script>
    <script type="text/javascript" src="../Types/Notifications/ChangeCollector.js"></script>

    <!--******************************* Types ****************************************-->
    <script type="text/javascript" src="../Types/Promise.js"></script>
    <script type="text/javascript" src="../Types/Entity.js"></script>
    <script type="text/javascript" src="../Types/EntityContext.js"></script>
    <script type="text/javascript" src="../Types/QueryProvider.js"></script>
    <script type="text/javascript" src="../Types/ModelBinder.js"></script>
    <script type="text/javascript" src="../Types/Query.js"></script>
    <script type="text/javascript" src="../Types/Queryable.js"></script>
    <script type="text/javascript" src="../Types/EntitySet.js"></script>

    <script type="text/javascript" src="../Types/AuthEntityContext.js"></script>
    <script type="text/javascript" src="../Types/EntityState.js"></script>
    <script type="text/javascript" src="../Types/EntityStateManager.js"></script>
    <script type="text/javascript" src="../Types/Exception.js"></script>
    <script type="text/javascript" src="../Types/StorageProviderLoader.js"></script>
    <script type="text/javascript" src="../Types/StorageProviderBase.js"></script>

    <script type="text/javascript" src="../Types/EntityWrapper.js"></script>

    <!--******************************* Ajax*********************************************-->
    <script type="text/javascript" src="../Types/Ajax/jQueryAjaxWrapper.js"></script>
    <script type="text/javascript" src="../Types/Ajax/WinJSAjaxWrapper.js"></script>
    <script type="text/javascript" src="../Types/Ajax/ExtJSAjaxWrapper.js"></script>
    <script type="text/javascript" src="../Types/Ajax/AjaxStub.js"></script>

    <!--******************************* DbClient ****************************************-->
    <script type="text/javascript" src="../Types/DbClient/DbCommand.js"></script>
    <script type="text/javascript" src="../Types/DbClient/DbConnection.js"></script>
    <script type="text/javascript" src="../Types/DbClient/OpenDatabaseClient/OpenDbCommand.js"></script>
    <script type="text/javascript" src="../Types/DbClient/OpenDatabaseClient/OpenDbConnection.js"></script>
    <script type="text/javascript" src="../Types/DbClient/JayStorageClient/JayStorageCommand.js"></script>
    <script type="text/javascript" src="../Types/DbClient/JayStorageClient/JayStorageConnection.js"></script>
    <script type="text/javascript" src="../Types/DbClient/SqLiteNJClient/SqLiteNjCommand.js"></script>
    <script type="text/javascript" src="../Types/DbClient/SqLiteNJClient/SqLiteNjConnection.js"></script>

    <script type="text/javascript" src="../Types/StorageProviders/modelBinderConfigCompiler.js"></script>
    <!--******************************* StorageProvider - sqLite ****************************************-->
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/SqLiteStorageProvider.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/SqLiteCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/SqlPagingCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/SqlOrderCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/SqlProjectionCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/ExpressionMonitor.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/SqlFilterCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/SqLite/ModelBinder/sqLite_ModelBinderCompiler.js"></script>
    <!--******************************* StorageProvider - oData ****************************************-->
    <script type="text/javascript" src="../Types/StorageProviders/oData/oDataProvider.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/oData/oDataCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/oData/oDataWhereCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/oData/oDataOrderCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/oData/oDataPagingCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/oData/oDataProjectionCompiler.js"></script>
    <!--******************************* StorageProvider - IndexDb ****************************************-->
    <script type="text/javascript" src="../Types/StorageProviders/IndexedDB/IndexedDBStorageProvider.js"></script>

    <!--******************************* Authentication???? ****************************************-->
    <script type="text/javascript" src="../Types/Authentication/AuthenticationBase.js"></script>
    <script type="text/javascript" src="../Types/Authentication/Anonymous.js"></script>
    <script type="text/javascript" src="../Types/Authentication/FacebookAuth.js"></script>

    <!--******************************* StorageProvider - Facebook ****************************************-->
    <script type="text/javascript" src="../Types/StorageProviders/Facebook/FacebookProvider.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/Facebook/FacebookCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/Facebook/EntitySets/FQL/user.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/Facebook/EntitySets/FQL/friend.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/Facebook/EntitySets/FQL/page.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/Facebook/EntitySets/FQLContext.js"></script>

    <!--******************************* StorageProvider - YQL ****************************************-->
    <script type="text/javascript" src="../Types/StorageProviders/YQL/YQLProvider.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/YQL/YQLCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/YQL/EntitySets/geo.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/YQL/EntitySets/YQLContext.js"></script>

    <!--******************************* StorageProvider - inMemory ****************************************-->
    <script type="text/javascript" src="../Types/StorageProviders/InMemory/InMemoryProvider.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/InMemory/InMemoryCompiler.js"></script>
    <script type="text/javascript" src="../Types/StorageProviders/InMemory/InMemoryFunctionCompiler.js"></script>

    <!--******************************* jsExtensions ****************************************-->
    <script type="text/javascript" src="../JayDataModules/deferred.js"></script>
    <script type="text/javascript" src="../JayDataModules/formBinder.js"></script>
    <script type="text/javascript" src="../JayDataModules/template.js"></script>
    <script type="text/javascript" src="../JayDataModules/validate.js"></script>
    <script type="text/javascript" src="../JayDataModules/knockout.js"></script>
    <script type="text/javascript" src="../JayDataModules/inMemory.js"></script>

    <!--************************************************************************************-->
    <script src="../NewsReaderContext.js" type="text/javascript"></script>

    <script type="text/javascript" src="gyeby.orp.builder.js"></script>
    <script type="text/javascript" src="gyeby.orp.lexer.js"></script>
    <script type="text/javascript" src="gyeby.orp.parser.js"></script>
    <!--**********************************UNIT TESTS****************************************-->
    <script type="text/javascript" src="ODataEntityExpressionBuilder.js"></script>

    <script type="text/javascript" src="gyeby.orp.currenttest.js"></script>
    <script type="text/javascript" src="gyeby.orp.lexertests.js"></script>
    <script type="text/javascript" src="gyeby.orp.parsertests.js"></script>
    <script type="text/javascript">
        function builderTest(name, queryable, context) {
            test(name, 1, function () {

                var q = queryable.toTraceString();

                var queryParts = q.queryText.split('?');
                var paramParts = queryParts[1].split('&');
                var obj = {};
                for (var i = 0; i < paramParts.length; i++) {
                    var parts = paramParts[i].split('=');
                    var name = parts[0].substr(1);
                    obj[name] = parts[1];
                }

                obj.entitySetName = queryParts[0].substr(1);
                var builder = new $data.oDataParser.ODataEntityExpressionBuilder(context);
                var expression = builder.buildExpression(obj);

                equal(JSON.stringify(expression), JSON.stringify(q.expression.source), name + ' builder test failed');
            });
        }
/*
        var c = new $news.Types.NewsContext({ name: 'oData' });
        var date = new Date();

        module('ODataEntityExpressionBuilder');
        builderTest('field compare int', c.Articles.filter(function (it) { return it.Id <= 500; }), c);
        builderTest('field compare string', c.Articles.filter(function (it) { return it.Title == 'Article1'; }), c);
        //builderTest('ODataEntityExpressionBuilder field multipleFilter', c.Articles.filter(function (it) { return it.Title == 'Article1'; }).filter(function (it) { return it.Body.contains('Body1'); }), c);
        builderTest('field contains', c.Articles.filter(function (it) { return it.Author.LoginName.contains('almafa'); }), c);
        builderTest('field compare complex', c.Articles.filter(function (it) { return it.Author.LoginName.contains('almafa') && it.CreateDate > '2001/05/05' && it.Id <= 500; }), c);
        builderTest('orderBy string', c.Articles.orderBy('it.Title'), c);
        builderTest('orderBy', c.Articles.orderBy(function (it) { return it.Title; }), c);
        builderTest('field compare, order by', c.Articles.filter(function (it) { return it.Author.LoginName.contains('almafa') && it.CreateDate > '2001/05/05' && it.Id <= 500; }).orderBy('it.Title'), c);
        builderTest('skip', c.Articles.skip(5), c);
        builderTest('take', c.Articles.take(6), c);
        builderTest('field compare, order by, skip, take', c.Articles.filter(function (it) { return it.Author.LoginName.contains('almafa') && it.CreateDate > '2001/05/05' && it.Id <= 500; }).orderBy('it.Title').skip(10).take(5), c);
        //builderTest('map', c.Articles.map(function (it) { return { a: it.Title, b: it.Body }; }), c);
*/
    </script>
</head>
<body>
    <h1 id="qunit-header">JayData oData Parser tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar">
    </div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests">
    </ol>
    <div id="qunit-fixture">
        test markup, will be hidden
    </div>
</body>
</html>

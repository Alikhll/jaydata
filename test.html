<!DOCTYPE html>
<html>
<head>
    <title>JayData unit tests</title>

    <!--<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>-->
    <link rel="stylesheet" href="scripts/qunit.css" type="text/css" media="screen" />
    
    <script type="text/javascript" src="scripts/qunit.js"></script>
    <script type="text/javascript" src="scripts/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="Scripts/jquery.validate.js"></script>
    <script type="text/javascript" src="Scripts/knockout-2.1.0.js"></script>
    
    <!--************************************************************************************-->
    <script type="text/javascript" src="TypeSystem/initializeJayData.js"></script>
    <script type="text/javascript" src="TypeSystem/utils.js"></script>
    <script type="text/javascript" src="TypeSystem/PreHtml5Compatible.js"></script>
    <script type="text/javascript" src="Scripts/datajs-1.0.2.js"></script>
    <script type="text/javascript" src="TypeSystem/JayLint.js"></script>
    <script type="text/javascript" src="TypeSystem/TypeSystem.js"></script>
    <!--*******************************Expressions****************************************-->
    <script type="text/javascript" src="Types/Expressions/ASTParser.js"></script>
    <script type="text/javascript" src="Types/Expressions/ExpressionNode2.js"></script>
    
    <script type="text/javascript" src="Types/Expressions/ArrayLiteralExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/CallExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/CodeParser.js"></script>
    <script type="text/javascript" src="Types/Expressions/ConstantExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/FunctionExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ObjectFieldExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ObjectLiteralExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/PagingExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ParameterExpression.js"> </script>
    <script type="text/javascript" src="Types/Expressions/PropertyExpression.js" ></script>   
    <script type="text/javascript" src="Types/Expressions/SimpleBinaryExpression.js" ></script>
    <script type="text/javascript" src="Types/Expressions/ThisExpression.js" ></script>    
    
    <script type="text/javascript" src="Types/Expressions/Visitors/ExpressionVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ParameterProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/GlobalContextProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LocalContextProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LambdaParameterProcessor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ParameterResolverVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/LogicalSchemaBinderVisitor.js"></script>

    <script type="text/javascript" src="Types/Expressions/Visitors/ExpTreeVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/SetExecutableVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/Visitors/ExecutorVisitor.js"></script>
    
    <script type="text/javascript" src="Types/Expressions/ExpressionBuilder.js"></script>
    
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/AssociationInfoExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/CodeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/CodeToEntityConverter.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ComplexTypeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityContextExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityExpressionVisitor.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityFieldExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntityFieldOperationExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/EntitySetExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/FilterExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/IncludeExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/MemberInfoExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/OrderExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ParametricQueryExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/ProjectionExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/QueryExpressionCreator.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/QueryParameterExpression.js"></script>
    <script type="text/javascript" src="Types/Expressions/EntityExpressions/RepresentationExpression.js"></script>
    
    <!--******************************* Validation ****************************************-->  
    <script type="text/javascript" src="Types/Validation/EntityValidationBase.js"></script>
    <script type="text/javascript" src="Types/Validation/EntityValidation.js"></script>
    <!--******************************* Notification ****************************************-->  
    <script type="text/javascript" src="Types/Notifications/ChangeDistributorBase.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeCollectorBase.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeDistributor.js"></script>
    <script type="text/javascript" src="Types/Notifications/ChangeCollector.js"></script>
    
    <!--******************************* Types ****************************************--> 
    <script type="text/javascript" src="Types/Promise.js"></script>
    <script type="text/javascript" src="Types/Entity.js"></script>
    <script type="text/javascript" src="Types/EntityContext.js"></script>
    <script type="text/javascript" src="Types/QueryProvider.js"></script>
    <script type="text/javascript" src="Types/ModelBinder.js"></script>
    <script type="text/javascript" src="Types/Query.js"></script>
    <script type="text/javascript" src="Types/Queryable.js"></script>
    <script type="text/javascript" src="Types/EntitySet.js"></script>
    <script type="text/javascript" src="Types/AuthEntityContext.js"></script>
    <script type="text/javascript" src="Types/EntityState.js"></script>
    <script type="text/javascript" src="Types/EntityStateManager.js"></script>
    <script type="text/javascript" src="Types/Exception.js"></script>
    <script type="text/javascript" src="Types/StorageProviderBase.js"></script>

    <script type="text/javascript" src="Types/EntityWrapper.js"></script>

    <!--******************************* DbClient ****************************************-->
    <script type="text/javascript" src="Types/DbClient/DbCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/DbConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/OpenDatabaseClient/OpenDbCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/OpenDatabaseClient/OpenDbConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/JayStorageClient/JayStorageCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/JayStorageClient/JayStorageConnection.js"></script>
    <script type="text/javascript" src="Types/DbClient/SqLiteNJClient/SqLiteNjCommand.js"></script>
    <script type="text/javascript" src="Types/DbClient/SqLiteNJClient/SqLiteNjConnection.js"></script>

    <script type="text/javascript" src="Types/StorageProviders/modelBinderConfigCompiler.js"></script>
    <!--******************************* StorageProvider - sqLite ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqLiteStorageProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqLiteCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlPagingCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlOrderCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlProjectionCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/ExpressionMonitor.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/SqlFilterCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/SqLite/ModelBinder/sqLite_ModelBinderCompiler.js"></script>
    <!--******************************* StorageProvider - oData ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataWhereCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataOrderCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataPagingCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/oData/oDataProjectionCompiler.js"></script>
    <!--******************************* StorageProvider - IndexDb ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/IndexedDB/IndexedDBStorageProvider.js"></script>
    
    <!--******************************* Authentication???? ****************************************-->
    <script type="text/javascript" src="Types/Authentication/AuthenticationBase.js"></script>
    <script type="text/javascript" src="Types/Authentication/Anonymous.js"></script>
    <script type="text/javascript" src="Types/Authentication/FacebookAuth.js"></script>

    <!--******************************* StorageProvider - Facebook ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/Facebook/FacebookProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/FacebookCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/user.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/friend.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQL/page.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/Facebook/EntitySets/FQLContext.js"></script>
    
    <!--******************************* StorageProvider - YQL ****************************************-->
    <script type="text/javascript" src="Types/StorageProviders/YQL/YQLProvider.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/YQLCompiler.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/EntitySets/geo.js"></script>
    <script type="text/javascript" src="Types/StorageProviders/YQL/EntitySets/YQLContext.js"></script>
        
    <!--******************************* jsExtensions ****************************************-->
    <script type="text/javascript" src="JayDataModules/deferred.js"></script>
    <script type="text/javascript" src="JayDataModules/formBinder.js"></script>
    <script type="text/javascript" src="JayDataModules/template.js"></script>
    <script type="text/javascript" src="JayDataModules/validate.js"></script>
    <script type="text/javascript" src="JayDataModules/knockout.js"></script>
    <!--************************************************************************************-->
    

    <!--**********************************UNIT TESTS****************************************-->
    <script src="NewsReaderContext.js" type="text/javascript"></script>
    <!--<script type="text/javascript">
        var db = openDatabase('lazarv', '', 'lazarv', 1024 * 1024);
        db.transaction(function(tran){
            tran.executeSql("DROP TABLE IF EXISTS test;");
            tran.executeSql("CREATE TABLE test (Id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, Value TEXT);");
            var i = 1;
            var testFn = function(tran){
                console.log('running test ' + i);
                document.body.innerHTML += 'running test ' + i + '<br>';
                for (var k = 1; k < 6; k++){
                    tran.executeSql("INSERT INTO test (Value) VALUES ('test" + k + "');");
                }
                tran.executeSql("SELECT * FROM test;", [], function(tran, result){
                    console.dir(result);
                    tran.executeSql("DELETE FROM test;");
                    if (i < 1000){
                        i++;
                        testFn(tran);
                    }
                }, function(tran, error){
                    console.error(error);
                });
            };
            testFn(tran);
        });
    </script>-->
    <!--<script type="text/javascript">
        var providerConfig = { name: "sqLite", databaseName: 'stress-test', dbCreation: $data.storageProviders.sqLite.DbCreationType.DropAllExistingTables };
        var msg = '_WebSQL';
        var cnt = 1;
        module("DataTests" + msg);
        (new $news.Types.NewsContext(providerConfig)).onReady(function (db) {
            var testFn = function(){
                //console.log('running test Filter_noFilter_' + cnt);
                //document.body.innerHTML += 'running test Filter_noFilter_' + cnt + '; ';
                //console.time();
                test('Filter_noFilter_' + cnt, function () {
                    expect(9);
                    stop(1);
                    $news.Types.NewsContext.generateTestData(db, function () {
                        start(1);
                        db.Categories.toArray(function (r) {
                            ok(r, "faild query");
                            equal(r.length, 5, 'Number of tags faild');
                            for (var i = 0; i < r.length; i++) {
                                db.Categories.remove(r[i]);
                                ok(r[i] instanceof $news.Types.Category, 'Data type error at ' + i + ' position');
                            }
                            equal(typeof r[0].Id, 'number', 'Field type error: Id');
                            equal(typeof r[0].Title, 'string', 'Field type error: Id');

                            start(1);
                            if (cnt < 1000){
                                cnt++;
                                //testFn();
                                window.setTimeout(testFn, 1);
                            }
                        });
                    });
                });
            };
            /*var timer = window.setInterval(function(){
                testFn();
                cnt++;
                if (cnt > 1000){
                    clearInterval(timer);
                    console.log('successful');
                }
            }, 20);*/
            testFn();
        });
    </script>-->

    <script src="UnitTests/typeSystemTests.js" type="text/javascript"></script>
    <script src="UnitTests/EntityContextTests.js" type="text/javascript"></script>

    <script src="UnitTests/dataDistributeTest.js" type="text/javascript"></script>

    <script src="UnitTests/ValidationTests.js" type="text/javascript"></script>

    <script src="UnitTests/knockoutTests.js" type="text/javascript"></script>

    <script src="UnitTests/sqLiteProviderTests.js" type="text/javascript"></script>
    <script src="UnitTests/sqLiteCompilerTests.js" type="text/javascript"></script>
    <script src="UnitTests/sqLiteCRUDTests.js" type="text/javascript"></script>

    <script src="UnitTests/oDataProviderTests.js" type="text/javascript"></script>

    <script src="UnitTests/T2.js" type="text/javascript"></script>
    <script src="UnitTests/T1.js" type="text/javascript"></script>
    <script src="UnitTests/T3.js" type="text/javascript"></script>
    <script src="UnitTests/loadPropertyTests.js" type="text/javascript"></script>
    <script src="UnitTests/ValidatonPluginTest.js" type="text/javascript"></script>
    <script src="UnitTests/promiseTests.js" type="text/javascript"></script>

    <script src="UnitTests/FaceBookProviderTests.js" type="text/javascript"></script>
    <script src="UnitTests/YQLProviderTests.js" type="text/javascript"></script>

    <!--<script src="UnitTests/AuthEntityContextTests.js" type="text/javascript"></script>--> <!--//TODO: fixed authentication context bugs-->
    <script src="UnitTests/indexedDbProviderTest.js" type="text/javascript"></script>
</head>
<body>
    <h1 id="qunit-header">
        JayData unit tests</h1>
    <h2 id="qunit-banner">
    </h2>
    <div id="qunit-testrunner-toolbar">
    </div>
    <h2 id="qunit-userAgent">
    </h2>
    <ol id="qunit-tests">
    </ol>
    <div id="qunit-fixture">
        test markup, will be hidden</div>
</body>
</html>
